<div class="repo-viewer-container">
  <!-- Global Toast -->
  <p-toast></p-toast>

  <!-- Topbar -->
  <app-repo-viewer-topbar
    [repoData]="repoData"
    [branches]="branches"
    [selectedBranch]="selectedBranch"
    [loadingBranches]="loading.branches"
    (branchChange)="onBranchChange($event)"
    (clearCredentials)="clearCredentials()"
    [formatDateFn]="formatDate.bind(this)"
    [githubService]="githubService"
  ></app-repo-viewer-topbar>

  <!-- Main Content (only this area scrolls) -->
  <div class="content-wrapper">
    <div class="content-scroll">
      <div class="columns">
        <!-- Left: File Tree -->
        <app-repo-viewer-sidebar-files
          class="left"
          [fileTree]="fileTree"
          [loadingTree]="loading.tree"
          (nodeSelect)="onNodeSelect($event)"
          [fileCount]="fileTree.length || 0"
        ></app-repo-viewer-sidebar-files>

        <!-- Right: Code Viewer -->
        <app-repo-viewer-code-viewer
          class="right"
          [breadcrumbs]="breadcrumbs"
          [selectedFile]="selectedFile"
          [fileContent]="fileContent"
          [loadingFile]="loading.file"
          [error]="error"
          [getFileIconClassFn]="getFileIconClass.bind(this)"
          [formatFileSizeFn]="formatFileSize.bind(this)"
          (copy)="copyToClipboard($event)"
          (download)="downloadSelectedFile()"
          (retry)="loadRepository()"
        ></app-repo-viewer-code-viewer>
      </div>
    </div>
  </div>

  <p-drawer header="Chat with {{ repoData?.name }}" [(visible)]="visible" position="right" styleClass="custom-drawer">
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptatibus, facere?</p>
  </p-drawer>
  <div>
    <button (click)="visible = true" class="drawer-button">
      <i class="pi pi-comments"></i>
    </button>
  </div>
</div>
